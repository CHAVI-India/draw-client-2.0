{% extends 'base.html' %}

{% block title %}Manual Autosegmentation Help - DRAW v2.0{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Manual Autosegmentation Guide</h1>
        <p class="text-gray-600">Learn how to use the manual autosegmentation feature to process DICOM series with custom template selection.</p>
    </div>

    <!-- Overview -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-lg font-medium text-blue-800">What is Manual Autosegmentation?</h3>
                <div class="mt-2 text-sm text-blue-700">
                    <p>Manual autosegmentation allows you to bypass the automatic template matching system and manually select which autosegmentation template to use for each DICOM series. This gives you complete control over the processing workflow.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Step-by-step Guide -->
    <div class="space-y-8">
        <!-- Step 1 -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">1</div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Select Series for Processing</h3>
                    <div class="prose text-sm text-gray-600">
                        <p>Navigate to the <strong>Series Processing Status</strong> page and select one or more DICOM series that you want to process manually.</p>
                        <ul class="mt-2 space-y-1">
                            <li>• Use the checkboxes next to each series to select them</li>
                            <li>• You can use "Select All" to choose all visible series</li>
                            <li>• Only series that are not already processed can be selected</li>
                        </ul>
                    </div>
                    <div class="mt-4 bg-gray-50 rounded-lg p-3">
                        <p class="text-xs text-gray-500"><strong>Tip:</strong> Use the filters to narrow down the series list before making your selection.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">2</div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Open Manual Autosegmentation Modal</h3>
                    <div class="prose text-sm text-gray-600">
                        <p>Once you have selected your series, click the <strong>"Manual Autosegmentation"</strong> button that appears in the selected actions bar.</p>
                        <ul class="mt-2 space-y-1">
                            <li>• The button only appears when series are selected</li>
                            <li>• A modal dialog will open showing your selected series</li>
                            <li>• Each series displays patient information and study details</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">3</div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Select Templates for Each Series</h3>
                    <div class="prose text-sm text-gray-600">
                        <p>For each series in the modal, select an appropriate autosegmentation template from the dropdown menu.</p>
                        <ul class="mt-2 space-y-1">
                            <li>• Each series must have exactly one template selected</li>
                            <li>• Templates show their name and description</li>
                            <li>• Different series can use different templates</li>
                            <li>• The system will validate your selections before processing</li>
                        </ul>
                    </div>
                    <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                        <p class="text-xs text-yellow-700"><strong>Important:</strong> Make sure to select appropriate templates based on the imaging modality and anatomical region.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4 -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">4</div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Validate and Start Processing</h3>
                    <div class="prose text-sm text-gray-600">
                        <p>Before starting the processing, validate your template selections and confirm the operation.</p>
                        <ul class="mt-2 space-y-1">
                            <li>• Click "Validate Selections" to check for any issues</li>
                            <li>• All series must have templates assigned</li>
                            <li>• Click "Start Processing" when validation passes</li>
                            <li>• Confirm the operation in the confirmation dialog</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5 -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-medium">5</div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Monitor Processing Status</h3>
                    <div class="prose text-sm text-gray-600">
                        <p>After starting the processing, you can monitor the progress and status of your manually processed series.</p>
                        <ul class="mt-2 space-y-1">
                            <li>• Processing happens asynchronously in the background</li>
                            <li>• Series status will update automatically</li>
                            <li>• You can view detailed processing information</li>
                            <li>• Failed processing can be retried if needed</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Workflow -->
    <div class="mt-12 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Processing Workflow</h3>
        <div class="space-y-4">
            <div class="flex items-center">
                <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                <div class="ml-3 text-sm text-gray-600">
                    <strong>Template Assignment:</strong> Your selected templates are associated with the series
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                <div class="ml-3 text-sm text-gray-600">
                    <strong>Deidentification:</strong> DICOM files are deidentified and template files are created
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                <div class="ml-3 text-sm text-gray-600">
                    <strong>Export:</strong> Processed files are exported to the DRAW API server
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-green-600 rounded-full"></div>
                <div class="ml-3 text-sm text-gray-600">
                    <strong>Completion:</strong> Series are ready for autosegmentation processing
                </div>
            </div>
        </div>
    </div>

    <!-- Status Meanings -->
    <div class="mt-8 bg-white border border-gray-200 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Processing Status Meanings</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-3">
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Rule Matched</span>
                    <span class="ml-3 text-sm text-gray-600">Template successfully assigned</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">Deidentified Successfully</span>
                    <span class="ml-3 text-sm text-gray-600">Files processed and ready for export</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">Pending Transfer</span>
                    <span class="ml-3 text-sm text-gray-600">Waiting to be sent to API server</span>
                </div>
            </div>
            <div class="space-y-3">
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">Sent To Server</span>
                    <span class="ml-3 text-sm text-gray-600">Successfully uploaded to DRAW API</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">Failed</span>
                    <span class="ml-3 text-sm text-gray-600">Processing encountered an error</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">RT Structure Received</span>
                    <span class="ml-3 text-sm text-gray-600">Segmentation completed and downloaded</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Troubleshooting -->
    <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-medium text-yellow-800 mb-4">Troubleshooting</h3>
        <div class="space-y-4 text-sm text-yellow-700">
            <div>
                <h4 class="font-medium">Series cannot be selected:</h4>
                <p>Series that are already processed or currently being processed cannot be selected for manual processing.</p>
            </div>
            <div>
                <h4 class="font-medium">Template selection validation fails:</h4>
                <p>Ensure every series has exactly one template selected. Check that all dropdowns have a value chosen.</p>
            </div>
            <div>
                <h4 class="font-medium">Processing fails:</h4>
                <p>Check the processing status page for detailed error information. Failed series can often be retried.</p>
            </div>
            <div>
                <h4 class="font-medium">Modal doesn't load series information:</h4>
                <p>This may indicate a network issue or server problem. Try refreshing the page and selecting series again.</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="mt-8 flex justify-between">
        <a href="{% url 'dicom_handler:series_processing_status' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Series Processing
        </a>
        <a href="{% url 'dicom_handler:template_list' %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Manage Templates
            <svg class="ml-2 -mr-1 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
            </svg>
        </a>
    </div>
</div>
{% endblock %}
