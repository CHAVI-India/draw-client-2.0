{% extends 'base.html' %}

{% block title %}DRAW v2.0 - Automatic Segmentation{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Hero Section -->
    <div class="text-center py-16">
        <h1 class="text-6xl font-bold text-gray-900 mb-6">
            DRAW- Client System
        </h1>
        <p class="text-xl text-gray-600 mb-4 max-w-6xl mx-auto">
            Deep Learning based Radiotherapy Autosegmentation Workflow (DRAW) provides users with a highly flexible and customizable automatic segmentation solution to be used for Radiotherapy. This Client System handles the DICOM data transfer and RT Structure Set retrieval from the server.
        </p>
        
        <!-- Caution Section -->
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-2 max-w-6xl mx-auto text-left">
            <div class="flex items-start">
                <div class="flex-shrink-0 mr-6">
                    <svg class="w-12 h-12 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div>
                    <p class="text-red-700 text-sm leading-relaxed">
                        AI based automatic segmentation can make mistakes. All contours generated using the DRAW autosegmentation system should be checked carefully by experienced personnel before approval. The final approval and responsibility rests with the treating oncologist. The DRAW system or its developers assume no liability from the use of the system and any errors arising out of the use of autosegmentation generated contours.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8 mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">Quick Actions</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
            {% if perms.dicom_handler.add_autosegmentationtemplate %}
            <a href="{% url 'dicom_handler:create_template' %}" class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors group">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 group-hover:bg-green-200 transition-colors">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                </div>
                <div class="text-left">
                    <div class="font-medium text-gray-900">Create Template</div>
                    <div class="text-sm text-gray-500">Setup segmentation model</div>
                </div>
            </a>
            {% endif %}

            {% if perms.dicom_handler.add_ruleset %}
            <a href="{% url 'dicom_handler:ruleset_create' %}" class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors group">
                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 group-hover:bg-purple-200 transition-colors">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                    </svg>
                </div>
                <div class="text-left">
                    <div class="font-medium text-gray-900">Create Ruleset</div>
                    <div class="text-sm text-gray-500">Define processing rules</div>
                </div>
            </a>
            {% endif %}

            {% if perms.dicom_handler.view_systemconfiguration %}
            <a href="{% url 'dicom_handler:system_configuration' %}" class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors group">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 group-hover:bg-blue-200 transition-colors">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <div class="text-left">
                    <div class="font-medium text-gray-900">System Configuration</div>
                    <div class="text-sm text-gray-500">Configure system settings</div>
                </div>
            </a>
            {% endif %}

                
            {% if perms.dicom_handler.view_dicomseries %}
            <a href="{% url 'dicom_handler:series_processing_status' %}" class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors group">
                <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 group-hover:bg-orange-200 transition-colors">
                    <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="text-left">
                    <div class="font-medium text-gray-900">Processing Status</div>
                    <div class="text-sm text-gray-500">Monitor DICOM processing</div>
                </div>
            </a>
            {% endif %}

            {% if user.is_authenticated %}
            <a href="{% url 'dicom_handler:statistics_dashboard' %}" class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors group">
                <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 group-hover:bg-indigo-200 transition-colors">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <div class="text-left">
                    <div class="font-medium text-gray-900">Statistics Dashboard</div>
                    <div class="text-sm text-gray-500">View processing analytics</div>
                </div>
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Workflow Overview -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8 mb-12">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-3">How DRAW Client Works</h2>
            <p class="text-gray-600 max-w-2xl mx-auto">Automated DICOM processing pipeline from planning CT to RT Structure delivery</p>
        </div>

        <!-- First Row - Steps 1-4 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Step 1: Poll Directory -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">1</span>
                </div>
                <div class="bg-white border-2 border-blue-400 rounded-xl p-4 pt-8 h-full hover:border-blue-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Poll Directory</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Monitors central directory for new DICOM series after planning CT</p>
                </div>
            </div>

            <!-- Step 2: Parse & Match -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">2</span>
                </div>
                <div class="bg-white border-2 border-purple-400 rounded-xl p-4 pt-8 h-full hover:border-purple-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Parse & Match Rules</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Extracts DICOM metadata and matches against configured rulesets</p>
                </div>
            </div>

            <!-- Step 3: Deidentify & YAML -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">3</span>
                </div>
                <div class="bg-white border-2 border-green-400 rounded-xl p-4 pt-8 h-full hover:border-green-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2V7l-6-4H6a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Deidentify & Prepare</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Removes patient identifiers and generates YAML instructions</p>
                </div>
            </div>

            <!-- Step 4: Upload -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">4</span>
                </div>
                <div class="bg-white border-2 border-indigo-400 rounded-xl p-4 pt-8 h-full hover:border-indigo-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-indigo-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Upload to Server</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Transfers deidentified series to API server for processing</p>
                </div>
            </div>
        </div>

        <!-- Second Row - Steps 5-8 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Step 5: Poll Server -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">5</span>
                </div>
                <div class="bg-white border-2 border-yellow-400 rounded-xl p-4 pt-8 h-full hover:border-orange-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-yellow-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Poll Server Status</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Monitors server API for job completion and result availability</p>
                </div>
            </div>

            <!-- Step 6: Download -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">6</span>
                </div>
                <div class="bg-white border-2 border-teal-400 rounded-xl p-4 pt-8 h-full hover:border-teal-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-teal-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Download RT Structure</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Retrieves completed RT Structure Set from the server</p>
                </div>
            </div>

            <!-- Step 7: Verify -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">7</span>
                </div>
                <div class="bg-white border-2 border-cyan-400 rounded-xl p-4 pt-8 h-full hover:border-blue-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-cyan-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Verify Integrity</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Validates checksum and confirms DICOM metadata tags</p>
                </div>
            </div>

            <!-- Step 8: Restore -->
            <div class="relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-500 rounded-full flex items-center justify-center shadow-lg z-10">
                    <span class="text-lg font-bold text-white">8</span>
                </div>
                <div class="bg-white border-2 border-pink-400 rounded-xl p-4 pt-8 h-full hover:border-rose-500 transition-colors">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-pink-50 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z"/></svg>
                        </div>
                        <h3 class="text-base font-bold text-gray-900">Reidentify & Restore</h3>
                    </div>
                    <p class="text-gray-600 text-sm">Restores patient identifiers and places RT Structure in series folder</p>
                </div>
            </div>
        </div>

        <!-- Key Features -->
        <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">Key Features</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2V7l-6-4H6a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    </div>
                    <p class="text-gray-700"><strong>Smart Rulesets:</strong> Automatically match DICOM series to appropriate segmentation templates</p>
                </div>
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2V7l-6-4H6a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    </div>
                    <p class="text-gray-700"><strong>Privacy First:</strong> Patient data is deidentified before leaving your environment</p>
                </div>
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    </div>
                    <p class="text-gray-700"><strong>Fully Automated:</strong> End-to-end processing with minimal manual intervention</p>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
