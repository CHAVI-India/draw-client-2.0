# Generated by Django 5.2.9 on 2026-01-02 14:08

import django.core.validators
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='AllowedAETitle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ae_title', models.CharField(help_text='Application Entity Title to allow (max 16 characters).', max_length=16, unique=True, validators=[django.core.validators.RegexValidator(code='invalid_ae_title', message='AE Title must contain only uppercase letters, numbers, underscores, and hyphens.', regex='^[A-Z0-9_\\-]+$')])),
                ('description', models.CharField(blank=True, help_text="Description of this AE (e.g., 'Main CT Scanner', 'MR Console').", max_length=255)),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='Expected IP address for this AE (optional, for documentation).', null=True)),
                ('is_active', models.BooleanField(default=True, help_text='Whether this AE is currently allowed to connect.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_connection', models.DateTimeField(blank=True, help_text='Timestamp of last successful connection from this AE.', null=True)),
            ],
            options={
                'verbose_name': 'Allowed AE Title',
                'verbose_name_plural': 'Allowed AE Titles',
                'ordering': ['ae_title'],
            },
        ),
        migrations.CreateModel(
            name='DicomServerConfig',
            fields=[
                ('id', models.IntegerField(default=1, editable=False, primary_key=True, serialize=False)),
                ('service_enabled', models.BooleanField(default=False, help_text='Enable or disable the DICOM service. When disabled, the service will not accept connections.')),
                ('auto_start', models.BooleanField(default=False, help_text='Automatically start the DICOM service when the Django application starts.')),
                ('ae_title', models.CharField(default='DRAW_SCP', help_text='Application Entity Title for this DICOM service (max 16 characters, uppercase alphanumeric).', max_length=16, validators=[django.core.validators.RegexValidator(code='invalid_ae_title', message='AE Title must contain only uppercase letters, numbers, underscores, and hyphens.', regex='^[A-Z0-9_\\-]+$')])),
                ('host', models.CharField(default='0.0.0.0', help_text='IP address to bind the DICOM service (0.0.0.0 for all interfaces, or specific IP).', max_length=45)),
                ('port', models.IntegerField(default=11112, help_text='Port number for DICOM communication (default: 11112, range: 1024-65535).', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('max_associations', models.IntegerField(default=10, help_text='Maximum number of concurrent DICOM associations/connections.', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)])),
                ('max_pdu_size', models.IntegerField(default=16384, help_text='Maximum Protocol Data Unit size in bytes (default: 16384, range: 4096-131072).', validators=[django.core.validators.MinValueValidator(4096), django.core.validators.MaxValueValidator(131072)])),
                ('network_timeout', models.IntegerField(default=30, help_text='Network timeout in seconds (default: 30).', validators=[django.core.validators.MinValueValidator(5), django.core.validators.MaxValueValidator(300)])),
                ('acse_timeout', models.IntegerField(default=30, help_text='ACSE (Association Control Service Element) timeout in seconds (default: 30).', validators=[django.core.validators.MinValueValidator(5), django.core.validators.MaxValueValidator(300)])),
                ('dimse_timeout', models.IntegerField(default=30, help_text='DIMSE (DICOM Message Service Element) timeout in seconds (default: 30).', validators=[django.core.validators.MinValueValidator(5), django.core.validators.MaxValueValidator(300)])),
                ('storage_root_path', models.CharField(default='/app/dicom_storage', help_text='Root directory path where received DICOM files will be stored.', max_length=512)),
                ('storage_structure', models.CharField(choices=[('flat', 'Flat - All files in root directory'), ('patient', 'Patient ID - Organized by Patient ID'), ('study', 'Study UID - Organized by Study Instance UID'), ('series', 'Series UID - Organized by Patient/Study/Series hierarchy'), ('date', 'Date - Organized by received date (YYYY/MM/DD)')], default='series', help_text='Directory structure for organizing stored DICOM files.', max_length=20)),
                ('file_naming_convention', models.CharField(choices=[('sop_uid', 'SOP Instance UID'), ('instance_number', 'Instance Number'), ('timestamp', 'Timestamp'), ('sequential', 'Sequential Number')], default='sop_uid', help_text='Naming convention for stored DICOM files.', max_length=20)),
                ('max_storage_size_gb', models.IntegerField(default=100, help_text='Maximum storage size in GB. Service will reject new files when limit is reached.', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10000)])),
                ('enable_storage_cleanup', models.BooleanField(default=False, help_text='Enable automatic cleanup of old files when storage limit is reached.')),
                ('storage_retention_days', models.IntegerField(default=30, help_text='Number of days to retain files before cleanup (only if cleanup is enabled).', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(3650)])),
                ('require_calling_ae_validation', models.BooleanField(default=True, help_text='Require validation of calling AE titles. Only allowed AE titles can connect.')),
                ('require_ip_validation', models.BooleanField(default=False, help_text='Require IP address validation. Only whitelisted IPs can connect.')),
                ('allowed_ip_addresses', models.TextField(blank=True, help_text='Comma-separated list of allowed IP addresses or CIDR ranges (e.g., 192.168.1.0/24, 10.0.0.5).', null=True)),
                ('support_ct_image_storage', models.BooleanField(default=True, help_text='Accept CT Image Storage (1.2.840.10008.5.1.4.1.1.2).')),
                ('support_mr_image_storage', models.BooleanField(default=True, help_text='Accept MR Image Storage (1.2.840.10008.5.1.4.1.1.4).')),
                ('support_rt_structure_storage', models.BooleanField(default=True, help_text='Accept RT Structure Set Storage (1.2.840.10008.5.1.4.1.1.481.3).')),
                ('support_rt_plan_storage', models.BooleanField(default=True, help_text='Accept RT Plan Storage (1.2.840.10008.5.1.4.1.1.481.5).')),
                ('support_rt_dose_storage', models.BooleanField(default=True, help_text='Accept RT Dose Storage (1.2.840.10008.5.1.4.1.1.481.2).')),
                ('support_secondary_capture', models.BooleanField(default=True, help_text='Accept Secondary Capture Image Storage (1.2.840.10008.5.1.4.1.1.7).')),
                ('enable_c_echo', models.BooleanField(default=True, help_text='Enable C-ECHO (verification/ping) service.')),
                ('enable_c_store', models.BooleanField(default=True, help_text='Enable C-STORE (receive DICOM files) service.')),
                ('enable_c_find', models.BooleanField(default=False, help_text='Enable C-FIND (query) service for Patient/Study/Series level queries.')),
                ('enable_c_move', models.BooleanField(default=False, help_text='Enable C-MOVE (retrieve) service to send DICOM files to remote destinations.')),
                ('enable_c_get', models.BooleanField(default=False, help_text='Enable C-GET (retrieve) service to send DICOM files over the same association.')),
                ('support_implicit_vr_little_endian', models.BooleanField(default=True, help_text='Support Implicit VR Little Endian transfer syntax (1.2.840.10008.1.2).')),
                ('support_explicit_vr_little_endian', models.BooleanField(default=True, help_text='Support Explicit VR Little Endian transfer syntax (1.2.840.10008.1.2.1).')),
                ('support_explicit_vr_big_endian', models.BooleanField(default=False, help_text='Support Explicit VR Big Endian transfer syntax (1.2.840.10008.1.2.2).')),
                ('support_jpeg_baseline', models.BooleanField(default=True, help_text='Support JPEG Baseline compression (1.2.840.10008.1.2.4.50).')),
                ('support_jpeg_lossless', models.BooleanField(default=True, help_text='Support JPEG Lossless compression (1.2.840.10008.1.2.4.70).')),
                ('support_jpeg2000_lossless', models.BooleanField(default=False, help_text='Support JPEG 2000 Lossless compression (1.2.840.10008.1.2.4.90).')),
                ('support_rle_lossless', models.BooleanField(default=False, help_text='Support RLE Lossless compression (1.2.840.10008.1.2.5).')),
                ('auto_import_to_handler', models.BooleanField(default=True, help_text='Automatically import received DICOM files into the DICOM Handler processing pipeline.')),
                ('copy_to_handler_folder', models.BooleanField(default=False, help_text='Copy received files to the DICOM Handler folder (from SystemConfiguration) for processing.')),
                ('trigger_processing_chain', models.BooleanField(default=False, help_text='Automatically trigger the DICOM processing chain (Task 1-4) for received studies.')),
                ('logging_level', models.CharField(choices=[('DEBUG', 'Debug - Verbose logging'), ('INFO', 'Info - Normal logging'), ('WARNING', 'Warning - Only warnings and errors'), ('ERROR', 'Error - Only errors')], default='INFO', help_text='Logging level for DICOM service operations.', max_length=10)),
                ('log_connection_attempts', models.BooleanField(default=True, help_text='Log all connection attempts (successful and failed).')),
                ('log_received_files', models.BooleanField(default=True, help_text='Log details of all received DICOM files.')),
                ('enable_performance_metrics', models.BooleanField(default=True, help_text='Track and log performance metrics (transfer speeds, processing times).')),
                ('notify_on_receive', models.BooleanField(default=False, help_text='Send notification when new DICOM data is received.')),
                ('notify_on_error', models.BooleanField(default=True, help_text='Send notification when errors occur during DICOM operations.')),
                ('notification_email', models.EmailField(blank=True, help_text='Email address for notifications (leave blank to disable email notifications).', max_length=254, null=True)),
                ('validate_dicom_on_receive', models.BooleanField(default=True, help_text='Validate DICOM file structure and required tags on receive.')),
                ('reject_invalid_dicom', models.BooleanField(default=False, help_text='Reject and do not store invalid DICOM files.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_service_start', models.DateTimeField(blank=True, help_text='Timestamp of last service start.', null=True)),
                ('last_service_stop', models.DateTimeField(blank=True, help_text='Timestamp of last service stop.', null=True)),
            ],
            options={
                'verbose_name': 'DICOM Server Configuration',
                'verbose_name_plural': 'DICOM Server Configuration',
            },
        ),
        migrations.CreateModel(
            name='DicomServiceStatus',
            fields=[
                ('id', models.IntegerField(default=1, editable=False, primary_key=True, serialize=False)),
                ('is_running', models.BooleanField(default=False, help_text='Whether the DICOM service is currently running.')),
                ('process_id', models.IntegerField(blank=True, help_text='Process ID of the running DICOM service.', null=True)),
                ('service_started_at', models.DateTimeField(blank=True, help_text='Timestamp when the service was started.', null=True)),
                ('service_stopped_at', models.DateTimeField(blank=True, help_text='Timestamp when the service was stopped.', null=True)),
                ('total_connections', models.IntegerField(default=0, help_text='Total number of connections since service start.')),
                ('active_connections', models.IntegerField(default=0, help_text='Current number of active connections.')),
                ('total_files_received', models.IntegerField(default=0, help_text='Total number of DICOM files received since service start.')),
                ('total_bytes_received', models.BigIntegerField(default=0, help_text='Total bytes received since service start.')),
                ('total_errors', models.IntegerField(default=0, help_text='Total number of errors since service start.')),
                ('last_connection_at', models.DateTimeField(blank=True, help_text='Timestamp of last connection.', null=True)),
                ('last_file_received_at', models.DateTimeField(blank=True, help_text='Timestamp of last file received.', null=True)),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='Last update timestamp.')),
            ],
            options={
                'verbose_name': 'DICOM Service Status',
                'verbose_name_plural': 'DICOM Service Status',
            },
        ),
        migrations.CreateModel(
            name='DicomTransaction',
            fields=[
                ('transaction_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('transaction_type', models.CharField(choices=[('C-ECHO', 'C-ECHO (Verification)'), ('C-STORE', 'C-STORE (Storage)'), ('C-FIND', 'C-FIND (Query)'), ('C-MOVE', 'C-MOVE (Move)'), ('C-GET', 'C-GET (Get)'), ('ASSOCIATION', 'Association Request')], help_text='Type of DICOM operation.', max_length=20)),
                ('status', models.CharField(choices=[('SUCCESS', 'Success'), ('FAILURE', 'Failure'), ('REJECTED', 'Rejected'), ('TIMEOUT', 'Timeout'), ('ABORTED', 'Aborted')], help_text='Status of the transaction.', max_length=20)),
                ('calling_ae_title', models.CharField(help_text='AE Title of the calling entity.', max_length=16)),
                ('called_ae_title', models.CharField(help_text='AE Title of the called entity (this server).', max_length=16)),
                ('remote_ip', models.GenericIPAddressField(help_text='IP address of the remote entity.')),
                ('remote_port', models.IntegerField(help_text='Port of the remote entity.')),
                ('patient_id', models.CharField(blank=True, help_text='Patient ID from DICOM file.', max_length=64, null=True)),
                ('study_instance_uid', models.CharField(blank=True, help_text='Study Instance UID.', max_length=128, null=True)),
                ('series_instance_uid', models.CharField(blank=True, help_text='Series Instance UID.', max_length=128, null=True)),
                ('sop_instance_uid', models.CharField(blank=True, help_text='SOP Instance UID.', max_length=128, null=True)),
                ('sop_class_uid', models.CharField(blank=True, help_text='SOP Class UID (modality type).', max_length=128, null=True)),
                ('file_path', models.CharField(blank=True, help_text='Path where the file was stored (for C-STORE).', max_length=512, null=True)),
                ('file_size_bytes', models.BigIntegerField(blank=True, help_text='Size of the received file in bytes.', null=True)),
                ('transfer_syntax', models.CharField(blank=True, help_text='Transfer syntax used for the operation.', max_length=128, null=True)),
                ('duration_seconds', models.FloatField(blank=True, help_text='Duration of the transaction in seconds.', null=True)),
                ('transfer_speed_mbps', models.FloatField(blank=True, help_text='Transfer speed in MB/s (for C-STORE).', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if transaction failed.', null=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True, help_text='Timestamp when the transaction occurred.')),
            ],
            options={
                'verbose_name': 'DICOM Transaction',
                'verbose_name_plural': 'DICOM Transactions',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['-timestamp'], name='dicom_serve_timesta_c952d9_idx'), models.Index(fields=['calling_ae_title'], name='dicom_serve_calling_ff80ec_idx'), models.Index(fields=['study_instance_uid'], name='dicom_serve_study_i_043004_idx'), models.Index(fields=['status'], name='dicom_serve_status_a80b51_idx')],
            },
        ),
    ]
